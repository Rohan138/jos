2.1.
The purpose of the MPBOOTPHYS macro is to directly calculate absolute addresses of symbols in the mpentry.S. This done because the load address of the mpentry.S code is different than its link address, since every processor has a different mpentry_start value sent to it on STARTUP.

5.1.
This is for isolation and security of kernel and user execution. For example, if the stacks are shared with a CPU that is running important kernel code and another CPU code running malicious user code that overflows the stack, the security of the kernel executing kernel code is compromised. Furthermore, when an interrupt occurs, the hardware pushes a TrapFrame to the stack BEFORE checking the lock, which could cause the stack to corrupt another processor's stack data due to a race scenario,

6.1.
The pointer e points to the Env struct that is mapped to on the kernel stack, which is not affected by lcr3().

6.2. 
This ensures that the environment state between switching to/from user environments is preserved and the environment can be run later, by a different cpu if neccessary. The registers are saved in ```curenv->env_tf = *tf``` in ```kern/trap.c```.